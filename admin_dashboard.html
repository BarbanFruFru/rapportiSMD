<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Amministratore</title>
    <!-- Mantieni i tuoi stili CSS esistenti qui -->
    <style>
        /* I tuoi stili CSS esistenti */
    </style>
</head>
<body>
    <h1>Dashboard Amministratore</h1>

    <!-- Il tuo codice HTML esistente per le tabelle -->

    <!-- Modal per i dettagli -->
    <div id="detailsModal" class="modal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
        <div class="modal-content" style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px;">
            <span class="close" onclick="closeModal()" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
    // Funzione per visualizzare i dettagli
    function viewDetails(recordData) {
    const modal = document.getElementById('detailsModal');
    const modalContent = document.getElementById('modalContent');
    
    // Converti la stringa JSON in oggetto se necessario
    const record = typeof recordData === 'string' ? JSON.parse(recordData) : recordData;
    
    // Costruisci il contenuto HTML per i dettagli
    let detailsHtml = '<div class="modal-details">';
    for (const [key, value] of Object.entries(record)) {
        if (key !== '_sheetName' && key !== '_rowIndex') {
            const displayValue = key === 'Data' ? new Date(value).toLocaleDateString() : value;
            detailsHtml += `<p><strong>${key}:</strong> ${displayValue}</p>`;
        }
    }
    detailsHtml += '</div>';
    
    modalContent.innerHTML = detailsHtml;
    modal.style.display = 'block';
}

    // Funzione per chiudere il modal
    function closeModal() {
        const modal = document.getElementById('detailsModal');
        modal.style.display = 'none';
    }

    // Funzione per eliminare un record
    async function deleteRecord(sheetName, rowIndex) {
        if (confirm('Sei sicuro di voler eliminare questo record?')) {
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbw4WBwQ2RolwMDETAvZz9Snfqhsli_hA63dXwF6NCBc_PxiUB7WsX7SZo-fpZNhDU1FEw/exec', {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'delete',
                        sheet: sheetName,
                        row: rowIndex
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('Record eliminato con successo!');
                    // Ricarica la pagina per aggiornare la tabella
                    location.reload();
                } else {
                    alert('Errore durante l\'eliminazione del record');
                }
            } catch (error) {
                console.error('Errore:', error);
                alert('Errore durante l\'eliminazione del record');
            }
        }
    }

    // Chiudi il modal quando si clicca fuori da esso
    window.onclick = function(event) {
        const modal = document.getElementById('detailsModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    // Funzione per caricare i dati e popolare le tabelle
    async function loadData() {
        try {
            const response = await fetch('https://script.google.com/macros/s/AKfycbw4WBwQ2RolwMDETAvZz9Snfqhsli_hA63dXwF6NCBc_PxiUB7WsX7SZo-fpZNhDU1FEw/exec');
            const data = await response.json();
            
            // Popola le tabelle con i dati
            for (const [type, records] of Object.entries(data)) {
                const tableBody = document.querySelector(`#${type.toLowerCase()}Table tbody`);
                if (tableBody) {
                    tableBody.innerHTML = records.map(record => `
                        <tr>
                            <td>${record['Nome (IGN)']}</td>
                            <td>${record['Corpo']}</td>
                            <td>${record['Grado']}</td>
                            <td>${new Date(record['Data']).toLocaleDateString()}</td>
                            <td>
                                <button onclick='viewDetails(${JSON.stringify(record)})' class="btn btn-info">
                                    <i class="fas fa-eye"></i> Vedi Dettagli
                                </button>
                                <button onclick='deleteRecord("${record._sheetName}", ${record._rowIndex})' class="btn btn-danger">
                                    <i class="fas fa-trash"></i> Elimina
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            }
        } catch (error) {
            console.error('Errore nel caricamento dei dati:', error);
        }
    }

    // Carica i dati quando la pagina Ã¨ pronta
    document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>